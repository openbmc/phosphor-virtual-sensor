{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "31fff143_17c05811",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 11
      },
      "lineNbr": 0,
      "author": {
        "id": 1000000
      },
      "writtenOn": "2022-09-08T16:50:12Z",
      "side": 1,
      "message": "This seems like we are trying to set properties in entity manager configs?  I am not understanding.  I don\u0027t think this is expected.\n\nMaybe Ed can decipher what is going on here.",
      "revId": "303cfb592b8e383a3e9068f4d9b63b1e1f59a94e",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "8c275cd6_e266ddf6",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 11
      },
      "lineNbr": 0,
      "author": {
        "id": 1000153
      },
      "writtenOn": "2022-09-08T17:50:16Z",
      "side": 1,
      "message": "There\u0027s some precedence for this, given that entity-manager owns the \"Configuration\" of the thresholds and there are user-facing APIs (Redfish/IPMI) that allow folks that to dynamically change the thresholds at runtime, which today are mapped to directly modifying the EM config, such that it can survive a reboot.\n\nWhat I don\u0027t really understand about this use case is that it\u0027s debatably trying to do the \"right thing\" in making the actual sensor object modifyable, with a write-through to EM, rather than dropping directly to entity-manager to adjust the config. This is going to birfurcate some flows, which admittedly are probably ill-designed, but doing _both_ seems worse to me, in that there\u0027s no consistent API (some sensors you modify thresholds through EM, some sensors you can modify directly)\n\nNow, in a normal reactor, changing any part of the config generally amounts to the object being destroyed and reconstructed, given that the hysteresis rules need to store reading-to-reading state, and that state needs destroyed when a threshold it changed to give the mathematically correct behavior.\n\nTo summarize:\n1. Yes, your use case is valid, but I think already supported.\n2. Please make your use case more clear about what daemon is actually setting these.  IPMI and Redfish already are capable of setting these parameters directly through EM, so it\u0027s not clear why we would add extra code specific to PVS.",
      "parentUuid": "31fff143_17c05811",
      "revId": "303cfb592b8e383a3e9068f4d9b63b1e1f59a94e",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "018dc385_2d187d60",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 11
      },
      "lineNbr": 0,
      "author": {
        "id": 1001104
      },
      "writtenOn": "2022-09-15T09:59:47Z",
      "side": 1,
      "message": "I tried to learn the execution process of the following commands:\nipmitool sensor thresh  SYS_ 5V  ucr 7\n\nThe service that first receives and modifies the threshold is adcsensor; Then adcsensor passes the threshold data to EM.\nAll the sensors on the dbus sensos I know modify the threshold in this way.\n\n### Step 1:\ngetService:\nhttps://github.com/openbmc/phosphor-host-ipmid/blob/master/sensorhandler.cpp#L876\n\n\n```\nroot@NULL:~# busctl call  --verbose   xyz.openbmc_project.ObjectMapper /xyz/openbmc_project/object_mapper  xyz.openbmc_project.ObjectMapper GetObject   sas  /xyz/openbmc_project/sensors/voltage/SYS_5V  3 xyz.openbmc_project.Sensor.Value  xyz.openbmc_project.Sensor.Threshold.Warning xyz.openbmc_project.Sensor.Threshold.Critical\nMESSAGE \"a{sas}\" {\n        ARRAY \"{sas}\" {\n                DICT_ENTRY \"sas\" {\n                        STRING \"xyz.openbmc_project.ADCSensor\";\n                        ARRAY \"s\" {\n                                STRING \"xyz.openbmc_project.Association.Definitions\";\n                                STRING \"xyz.openbmc_project.Sensor.Threshold.Critical\";\n                                STRING \"xyz.openbmc_project.Sensor.Threshold.Warning\";\n                                STRING \"xyz.openbmc_project.Sensor.Value\";\n                                STRING \"xyz.openbmc_project.State.Decorator.Availability\";\n                                STRING \"xyz.openbmc_project.State.Decorator.OperationalStatus\";\n                        };\n                };\n        };\n};\n```\n\n### Step 2:\ngetAllDbusProperties:\nhttps://github.com/openbmc/phosphor-host-ipmid/blob/master/sensorhandler.cpp#L893\n\n```\nroot@NULL:~# busctl  call --verbose xyz.openbmc_project.ADCSensor /xyz/openbmc_project/sensors/voltage/SYS_5V org.freedesktop.DBus.Properties GetAll s xyz.openbmc_project.Sensor.Threshold.Critical\nMESSAGE \"a{sv}\" {\n        ARRAY \"{sv}\" {\n                DICT_ENTRY \"sv\" {\n                        STRING \"CriticalHigh\";\n                        VARIANT \"d\" {\n                                DOUBLE 7;\n                        };\n                };\n                DICT_ENTRY \"sv\" {\n                        STRING \"CriticalAlarmHigh\";\n                        VARIANT \"b\" {\n                                BOOLEAN false;\n                        };\n                };\n                DICT_ENTRY \"sv\" {\n                        STRING \"CriticalLow\";\n                        VARIANT \"d\" {\n                                DOUBLE 4.5;\n                        };\n                };\n                DICT_ENTRY \"sv\" {\n                        STRING \"CriticalAlarmLow\";\n                        VARIANT \"b\" {\n                                BOOLEAN true;\n                        };\n                };\n        };\n};\n\nroot@NULL:~#\n```\n\n### Step 3:\nsetDbusProperty\nhttps://github.com/openbmc/phosphor-host-ipmid/blob/master/sensorhandler.cpp#L957\n\n```\nroot@NULL:~# busctl set-property   xyz.openbmc_project.ADCSensor /xyz/openbmc_project/sensors/voltage/SYS_5V xyz.openbmc_project.Sensor.Threshold.Critical CriticalHigh  d 7\n```\n\n### Step 4:\nasync_method_call:Set\nhttps://github.com/openbmc/dbus-sensors/blob/master/src/Thresholds.cpp#L183\n\n```\nroot@NULL:~# busctl set-property xyz.openbmc_project.EntityManager  /xyz/openbmc_project/inventory/system/board/NF5280M7_Motherboard/SYS_5V  xyz.openbmc_project.Configuration.ADC.Thresholds0   Value  d  7.000\nroot@NULL:~# \n```",
      "parentUuid": "8c275cd6_e266ddf6",
      "revId": "303cfb592b8e383a3e9068f4d9b63b1e1f59a94e",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    }
  ]
}